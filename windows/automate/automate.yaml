run:
  do:
    - build
    - pack
  workdir: c:/temp
  msys2:
    prefix: c:/msys32/
    wrapper: usr/bin/bash --login -c
  mingw32:
    prefix: mingw32
  perl:
    prefix: c:/strawberry/
  cygwin:
    wrapper: bin/bash --login -c
    prefix: c:/cygwin/

setup:
  msys2:
    url: http://repo.msys2.org/distrib/i686/msys2-i686-20161025.exe
    autoinstall-script-url: https://raw.githubusercontent.com/msys2/msys2-installer/master/auto-install.js
    product: MSYS2
    commands:
      update:
        - pacman -Syu --noconfirm
        - pacman -Su --noconfirm
      install: pacman -S --noconfirm --needed
      uninstall: maintenancetool.exe
    packages:
      - perl
      - git
      - make
      - msys2-devel
      - mingw-w64-i686-toolchain
      - mingw-w64-i686-libtool
      - intltool
      - autoconf
      - automake
      - tar
      - mingw-w64-i686-libsndfile
      - mingw-w64-i686-pcre
      - libtool
      - nasm

  perl:
    url: http://strawberryperl.com/download/5.26.1.1/strawberry-perl-5.26.1.1-32bit.msi
    product: Strawberry Perl
    modules:
      cpan:
        - Config::Properties
      git:
        - url: foo
          branch: bar

  cygwin:
    url: https://www.cygwin.com/setup-x86.exe
    site: http://cygwin.netbet.org/
    product: Cygwin
    packages:
      - git
      - gcc-g++
      - gcc-core
      - bash
      - binutils
      - libtool
      - autoconf
      - automake
      - pkg-config
      - make
      - libjpeg-devel
      - libpng-devel
      - xorg-server-devel
      - imake

build:
  pulseaudio:
    repository:
      url: https://github.com/theqvd/pulseaudio.git
      branch: opus
    build:
      env: mingw32
      commands:
        clean: git clean -dfx
        bootstrap: NOCONFIGURE=1 ./bootstrap.sh
        configure: ./configure --disable-nls --disable-rpath --disable-largefile --disable-memfd --disable-x11 --disable-tests --disable-oss-output --disable-oss-wrapper --disable-alsa --disable-esound --disable-solaris --disable-coreaudio-output --disable-glib2 --disable-gtk3 --disable-gconf --disable-avahi --disable-jack --disable-asyncns --disable-tcpwrap --disable-lirc --disable-dbus --disable-bluez4 --disable-bluez5 --disable-bluez5-ofono-headset --disable-bluez5-native-headset --disable-udev --disable-hal-compat --disable-ipv6 --disable-openssl --disable-systemd-daemon --disable-systemd-login --disable-systemd-journal --disable-manpages --disable-per-user-esound-socket --disable-default-build-tests --disable-legacy-database-entry-format --without-libiconv-prefix --without-libintl-prefix --prefix=$PULSEAUDIO_OUTDIR_CYGWIN
        make: make
        install: make install

  win-sftp-server:
    repository:
      url: https://github.com/salva/win-sftp-server.git
      branch: master
    build:
      env: mingw32
      commands:
        clean: git clean -dfx
        make: make
        install: cp win-sftp-server.exe $WIN_SFTP_SERVER_OUTDIR/win-sftp-server

  nxproxy:
    repository:
      url: https://github.com/ArcticaProject/nx-libs.git
      # branch: 9193d11eeeea933e293acd5e0f03fa4e9887186b
      branch: 3.6.x
      #url: https://github.com/salva/nx-libs.git
      #branch: fix-cygwin-compilation

    build:
      env: cygwin
      commands:
        clean: git clean -dfx
    children:
      - name: nxcomp
        build:
          commands:
            bootstrap: autoreconf -vfi
            configure: ./configure --prefix=$NXPROXY_OUTDIR_CYGWIN
            make: make
            install: make install
      - name: nxproxy
        build:
          commands:
            bootstrap: autoreconf -vfi
            configure: ./configure --prefix=$NXPROXY_OUTDIR_CYGWIN
            make: make
            install: make install

  qvd-slaveserver-wrapper:
    repository:
      url: https://github.com/theqvd/theqvd.git
      branch: client-cleanup
    build:
      env: cygwin
      subdir: windows/qvd-slaveserver-wrapper
      commands:
        make: make -f Makefile.cygwin
        install: cp qvd-slaveserver-wrapper.exe $QVD_SLAVESERVER_WRAPPER_OUTDIR_CYGWIN